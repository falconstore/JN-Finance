import { ImovelData } from '@/types';
import { ivelyDatabase, ivelyInfo } from './ively-database';
import { renatoDatabase, renatoInfo } from './renato-database';

// ============================================
// ðŸ  BANCO DE DADOS PRINCIPAL JN FINANÃ‡AS
// Combinando todos os imÃ³veis
// ============================================

export const database: ImovelData = {
  ively: ivelyDatabase,
  renato: renatoDatabase
};

// InformaÃ§Ãµes dos imÃ³veis
export const imoveisInfo = {
  ively: ivelyInfo,
  renato: renatoInfo
};

// ============================================
// ðŸ“Š FUNÃ‡Ã•ES UTILITÃRIAS
// ============================================

export const getTotalParcelas = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].length;
};

export const getParcelasPagas = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].filter(p => p.situacao === 'Pago').length;
};

export const getParcelasVencidas = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].filter(p => p.situacao === 'Vencida').length;
};

export const getParcelasAVencer = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].filter(p => p.situacao === 'Ã€ Vencer').length;
};

export const getValorTotalPago = (imovel: 'ively' | 'renato'): number => {
  return database[imovel]
    .filter(p => p.valorPago !== null)
    .reduce((sum, p) => sum + (p.valorPago || 0), 0);
};

export const getValorTotalRestante = (imovel: 'ively' | 'renato'): number => {
  return database[imovel]
    .filter(p => p.valorPago === null)
    .reduce((sum, p) => sum + p.parcelaComJuros, 0);
};

export const getValorTotal = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].reduce((sum, p) => sum + p.parcelaComJuros, 0);
};

export const getTotalJuros = (imovel: 'ively' | 'renato'): number => {
  return database[imovel].reduce((sum, p) => sum + (p.jurosValor || 0), 0);
};

// FunÃ§Ã£o para buscar uma parcela especÃ­fica
export const getParcela = (imovel: 'ively' | 'renato', numeroParcela: number) => {
  return database[imovel].find(p => p.parcela === numeroParcela);
};

// FunÃ§Ã£o para filtrar parcelas por situaÃ§Ã£o
export const getParcelasPorSituacao = (imovel: 'ively' | 'renato', situacao: string) => {
  return database[imovel].filter(p => p.situacao === situacao);
};

// FunÃ§Ã£o para obter estatÃ­sticas gerais
export const getEstatisticas = (imovel: 'ively' | 'renato') => {
  const parcelas = database[imovel];
  
  return {
    total: parcelas.length,
    pagas: getParcelasPagas(imovel),
    aVencer: getParcelasAVencer(imovel),
    vencidas: getParcelasVencidas(imovel),
    valorTotal: getValorTotal(imovel),
    valorPago: getValorTotalPago(imovel),
    valorRestante: getValorTotalRestante(imovel),
    totalJuros: getTotalJuros(imovel),
    percentualPago: Math.round((getParcelasPagas(imovel) / parcelas.length) * 100)
  };
};

// ============================================
// ðŸ”„ FUNCÃ•ES DE ATUALIZAÃ‡ÃƒO (FUTURO FIREBASE)
// ============================================

export const atualizarParcela = async (
  imovel: 'ively' | 'renato', 
  numeroParcela: number, 
  dadosAtualizados: Partial<any>
) => {
  // Aqui serÃ¡ implementada a atualizaÃ§Ã£o no Firebase
  console.log(`Atualizando parcela ${numeroParcela} do ${imovel}:`, dadosAtualizados);
  
  // Por enquanto, apenas log
  return Promise.resolve();
};

export const salvarTodasAlteracoes = async () => {
  // Salvar todas as alteraÃ§Ãµes no Firebase
  console.log('Salvando todas as alteraÃ§Ãµes no Firebase...');
  return Promise.resolve();
};

// ExportaÃ§Ãµes principais
export * from './ively-database';
export * from './renato-database';